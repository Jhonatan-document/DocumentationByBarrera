<!DOCTYPE html>
<html>
  <head>
<title>Documentación</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
  body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f4;
        }
        .container {
            max-width: 900px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        h1, h2 {
            color: #333;
        }
        pre {
            background: #eee;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
        .section {
            margin-bottom: 20px;
        }
  </style>
  </head>
<body class="w3-light-grey w3-content" style="max-width:1600px">

<!-- Sidebar/menu -->
<nav class="w3-sidebar w3-collapse w3-white w3-animate-left" style="z-index:3;width:300px;" id="mySidebar"><br>
  <div class="w3-container">
    <a href="#" onclick="w3_close()" class="w3-hide-large w3-right w3-jumbo w3-padding w3-hover-grey" title="close menu">
      <i class="fa fa-remove"></i>
    </a>
    <img src="logo-celsia-1024x854.png" style="width:45%;" class="w3-round"><br><br>
    <h4><b>Documentación cotizador versión 3.0</b></h4>
    <p class="w3-text-grey">Template by W3.CSS</p>
  </div>
  <div class="w3-bar-block">
    <a href="#Create" onclick="w3_close()" class="w3-bar-item w3-button w3-padding "><i class="fa fa-th-large fa-fw w3-margin-right"></i>Creación del Forms</a> 
    <a href="#List" onclick="w3_close()" class="w3-bar-item w3-button w3-padding"><i class="fa fa-th-large fa-fw w3-margin-right"></i>Automatización de listas desplegables</a> 
    <a href="#Condicionales" onclick="w3_close()" class="w3-bar-item w3-button w3-padding"><i class="fa fa-th-large fa-fw w3-margin-right"></i>Vinculación de secciónes dependiendo de la respuesta seleccionada</a>
  </div>

</nav>

<!-- Overlay effect when opening sidebar on small screens -->
<div class="w3-overlay w3-hide-large w3-animate-opacity" onclick="w3_close()" style="cursor:pointer" title="close side menu" id="myOverlay"></div>

<!-- !PAGE CONTENT! -->
<div class="w3-main" style="margin-left:300px">

  <!-- Header -->
  <header id="portfolio">
    <a href="#"><img src="/w3images/avatar_g2.jpg" style="width:65px;" class="w3-circle w3-right w3-margin w3-hide-large w3-hover-opacity"></a>
    <span class="w3-button w3-hide-large w3-xxlarge w3-hover-text-grey" onclick="w3_open()"><i class="fa fa-bars"></i></span>
    <div class="w3-container">
    <h1><b>Documentación</b></h1>
    <div class="w3-section w3-bottombar w3-padding-16">
      <button class="w3-button w3-black">ALL</button>
      <button class="w3-button w3-white"><i class="fa fa-diamond w3-margin-right"></i>Design</button>
      <button class="w3-button w3-white w3-hide-small"><i class="fa fa-photo w3-margin-right"></i>Photos</button>
      <button class="w3-button w3-white w3-hide-small"><i class="fa fa-map-pin w3-margin-right"></i>Art</button>
    </div>
    </div>
  </header>
  


    <div class="container" id="Create">
        <h1>Generación de Formularios con Apps Script</h1>
        
        <div class="section">
            <h2>Descripción General</h2>
            <p>Este script de Google Apps Script permite la creación y modificación de formularios de Google Forms basados en datos de una hoja de cálculo en Google Sheets.</p>
        </div>
        
        <div class="section">
            <h2>Función Principal</h2>
            <p><strong>updateExistingFormV2(formId, spreadsheetId)</strong></p>
            <p>Esta función abre un formulario de Google Forms y una hoja de cálculo de Google Sheets, luego actualiza el formulario con las secciones y preguntas necesarias.</p>
            <pre>
    function updateExistingFormV2(formId, spreadsheetId) {
    var form = FormApp.openById(formId);
    var sheet = SpreadsheetApp.openById(spreadsheetId).getSheetByName('Validaciones');
    var data = sheet.getRange('A2:P').getValues();
    
    form.setTitle('COTIZADOR CELSIA 2.0');
    form.setDescription('Este cotizador cuenta con un alcance de ofertas EPC entre 5kWp y 130kWp.');
    
    addBasicInfo(form);
    addCommercialInfo(form, data);
    addClientInfo(form);
    addTechnicalClientInfo(form, data);
    addTechnicalInfo(form, data);
    addAdjustments(form);
    addInverterInfo(form, data);
}
            </pre>
        </div>

        <div class="section">
            <h2>Funciones Auxiliares</h2>
            <p><strong>addBasicInfo(form)</strong>: Agrega preguntas básicas como correo y contraseña.</p>
            <p><strong>addCommercialInfo(form, data)</strong>: Agrega información comercial desde la hoja de cálculo.</p>
            <p><strong>addClientInfo(form)</strong>: Agrega información del cliente.</p>
            <p><strong>addTechnicalClientInfo(form, data)</strong>: Agrega preguntas técnicas del cliente.</p>
            <p><strong>addTechnicalInfo(form, data)</strong>: Agrega preguntas técnicas generales.</p>
            <p><strong>addAdjustments(form)</strong>: Agrega ajustes al formulario.</p>
            <p><strong>addInverterInfo(form, data)</strong>: Agrega información sobre inversores.</p>
        </div>
    </div>
    <br>    

  <div class="container" id="Lista">
      
      <div class="section">
          <h2>Actualización de campos tipo lista despegables</h2>
          <p>Este script actualiza automáticamente las opciones de las preguntas de tipo lista desplegable en un formulario de Google Forms, basándose en datos de una hoja de Google Sheets.</p>
      </div>

      <div class="section">
          <h2>Funciones Principales</h2>
          <h3>updateAllDropdownsWithLog()</h3>
          <p>Esta función toma un ID de formulario y un ID de hoja de cálculo, y actualiza las preguntas tipo lista desplegable con los datos de la hoja de validaciones.</p>
          <pre>
function updateAllDropdownsWithLog(formId, spreadsheetId, sheetName, logSheetName)
          </pre>
          <p><strong>Parámetros:</strong></p>
          <ul>
              <li><code>formId</code>: ID del formulario de Google Forms.</li>
              <li><code>spreadsheetId</code>: ID de la hoja de Google Sheets.</li>
              <li><code>sheetName</code>: Nombre de la hoja que contiene las opciones.</li>
              <li><code>logSheetName</code>: Nombre de la hoja de bitácora donde se registran los cambios.</li>
          </ul>
      </div>

      <div class="section">
          <h2>Registro de Cambios</h2>
          <p>El script compara las opciones actuales de cada lista desplegable con las opciones en la hoja de cálculo. Si hay cambios, los registra en una hoja de bitácora con la siguiente estructura:</p>
          <ul>
              <li>Fecha</li>
              <li>Pregunta</li>
              <li>Tipo de Cambio (Creado, Modificado, Eliminado)</li>
              <li>Opciones Antes</li>
              <li>Opciones Después</li>
              <li>Ejecutado por</li>
          </ul>
      </div>

      <div class="section">
          <h2>Función de Obtención de Nombre</h2>
          <h3>obtenerNombreUsuario()</h3>
          <p>Extrae el nombre del usuario a partir del correo electrónico:</p>
          <pre>
function obtenerNombreUsuario(email) {
  var nombre = email.split("@")[0];
  return nombre.charAt(0).toUpperCase() + nombre.slice(1);
 }
          </pre>
      </div>
  </div>
  <br>
  <div class="container" id="Condicionales">
    <h1>Configuración de Lógica de Salto en Formularios</h1>
    <p>Este script configura la lógica de salto en un formulario de Google Forms, permitiendo que ciertas respuestas redirijan a secciones específicas.</p>
    
    <h2>Descripción</h2>
    <p>El script busca una pregunta específica de tipo "Opción múltiple" y asigna la navegación a diferentes secciones del formulario según las respuestas seleccionadas.</p>
    
    <h2>Funcionamiento</h2>
    <ul>
        <li>Busca la pregunta clave especificada en <code>BUSCAR_TITULO</code>.</li>
        <li>Asocia cada respuesta con una sección específica si está definida en <code>SECCIONES_DESTINO</code>.</li>
        <li>Si no hay una sección definida, la opción continuará normalmente sin cambios.</li>
    </ul>
    
    <h2>Código</h2>
    <pre>
function configurarLogicaDeSalto(formId = "FORM_ID") {
var FORM_ID = formId;
var BUSCAR_TITULO = "¿Qué tipo de cotización es?";
var SECCIONES_DESTINO = { "Oferta": "Ajustess", "Pre-oferta": "INVERSORES" };
var form = FormApp.openById(FORM_ID);
var items = form.getItems();
var preguntaItem = null;

for (var i = 0; i < items.length; i++) {
    var item = items[i];
    if (item.getType() === FormApp.ItemType.MULTIPLE_CHOICE && item.getTitle() === BUSCAR_TITULO) {
        preguntaItem = item.asMultipleChoiceItem();
        break;
    }
}
if (!preguntaItem) return;

var choices = preguntaItem.getChoices();
var nuevasOpciones = [];

choices.forEach(choice => {
    var textoRespuesta = choice.getValue();
    var destinoTitulo = SECCIONES_DESTINO[textoRespuesta];
    var destino = form.getItems(FormApp.ItemType.PAGE_BREAK)
        .map(item => item.asPageBreakItem())
        .find(page => page.getTitle() === destinoTitulo);
    
    nuevasOpciones.push(preguntaItem.createChoice(textoRespuesta, destino || FormApp.PageNavigationType.CONTINUE));
});

preguntaItem.setChoices(nuevasOpciones);
}
    </pre>
    
    <h2>Consideraciones</h2>
    <ul>
        <li>Asegúrate de que las secciones del formulario tienen los mismos títulos especificados en <code>SECCIONES_DESTINO</code>.</li>
        <li>El script solo funciona con preguntas de opción múltiple.</li>
        <li>Si una respuesta no tiene una sección definida, continuará sin cambios.</li>
    </ul>
</div>


  
  <div class="w3-black w3-center w3-padding-24">Powered by <a href="https://www.w3schools.com/w3css/default.asp" title="W3.CSS" target="_blank" class="w3-hover-opacity">w3.css</a></div>

<!-- End page content -->
</div>

<script>
// Script to open and close sidebar
function w3_open() {
    document.getElementById("mySidebar").style.display = "block";
    document.getElementById("myOverlay").style.display = "block";
}
 
function w3_close() {
    document.getElementById("mySidebar").style.display = "none";
    document.getElementById("myOverlay").style.display = "none";
}
document.addEventListener("DOMContentLoaded", function () {
    let navLinks = document.querySelectorAll(".w3-bar-item");

    // ✅ Función para resaltar el enlace activo
    function setActiveLink(link) {
        navLinks.forEach(item => item.classList.remove("w3-text-teal")); // Remueve la clase de todos
        link.classList.add("w3-text-teal"); // Agrega la clase al enlace activo
    }

    // ✅ Evento de clic para resaltar el enlace seleccionado
    navLinks.forEach(link => {
        link.addEventListener("click", function () {
            setActiveLink(this);
        });
    });

    // ✅ Evento de scroll para resaltar el enlace según la sección visible
    window.addEventListener("scroll", function () {
        let sections = document.querySelectorAll("section"); // Asegúrate de que cada sección tiene un ID
        let scrollPosition = window.scrollY;

        sections.forEach((section, index) => {
            let rect = section.getBoundingClientRect();
            if (rect.top >= 0 && rect.top < window.innerHeight / 2) {
                setActiveLink(navLinks[index]); // Resalta el enlace del menú correspondiente
            }
        });
    });
});


</script>

</body>
</html>
