<!DOCTYPE html>
<html>
  <head>
<title>Documentaci√≥n</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
  body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f4;
        }
        .container {
            max-width: 900px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        h1, h2 {
            color: #333;
        }
        pre {
            background: #eee;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
        .section {
            margin-bottom: 20px;
        }
  </style>
  </head>
<body class="w3-light-grey w3-content" style="max-width:1600px">

<!-- Sidebar/menu -->
<nav class="w3-sidebar w3-collapse w3-white w3-animate-left" style="z-index:3;width:300px;" id="mySidebar"><br>
  <div class="w3-container">
    <a href="#" onclick="w3_close()" class="w3-hide-large w3-right w3-jumbo w3-padding w3-hover-grey" title="close menu">
      <i class="fa fa-remove"></i>
    </a>
    <img src="logo-celsia-1024x854.png" style="width:45%;" class="w3-round"><br><br>
    <h4><b>Documentaci√≥n cotizador versi√≥n 3.0</b></h4>
    <p class="w3-text-grey">Template by W3.CSS</p>
  </div>
  <div class="w3-bar-block">
    <a href="#Create" onclick="w3_close()" class="w3-bar-item w3-button w3-padding w3-text-teal"><i class="fa fa-th-large fa-fw w3-margin-right"></i>Creaci√≥n del Forms</a> 
    <a href="#List" onclick="w3_close()" class="w3-bar-item w3-button w3-padding"><i class="fa fa-th-large fa-fw w3-margin-right"></i>Automatizaci√≥n de listas desplegables</a> 
    <a href="#contact" onclick="w3_close()" class="w3-bar-item w3-button w3-padding"><i class="fa fa-th-large fa-fw w3-margin-right"></i>Vinculaci√≥n de secci√≥nes dependiendo de la respuesta seleccionada</a>
  </div>

</nav>

<!-- Overlay effect when opening sidebar on small screens -->
<div class="w3-overlay w3-hide-large w3-animate-opacity" onclick="w3_close()" style="cursor:pointer" title="close side menu" id="myOverlay"></div>

<!-- !PAGE CONTENT! -->
<div class="w3-main" style="margin-left:300px">

  <!-- Header -->
  <header id="portfolio">
    <a href="#"><img src="/w3images/avatar_g2.jpg" style="width:65px;" class="w3-circle w3-right w3-margin w3-hide-large w3-hover-opacity"></a>
    <span class="w3-button w3-hide-large w3-xxlarge w3-hover-text-grey" onclick="w3_open()"><i class="fa fa-bars"></i></span>
    <div class="w3-container">
    <h1><b>Documentaci√≥n</b></h1>
    <div class="w3-section w3-bottombar w3-padding-16">
      <button class="w3-button w3-black">ALL</button>
      <button class="w3-button w3-white"><i class="fa fa-diamond w3-margin-right"></i>Design</button>
      <button class="w3-button w3-white w3-hide-small"><i class="fa fa-photo w3-margin-right"></i>Photos</button>
      <button class="w3-button w3-white w3-hide-small"><i class="fa fa-map-pin w3-margin-right"></i>Art</button>
    </div>
    </div>
  </header>
  


    <div class="container" id="Create">
        <h1>Generaci√≥n de Formularios con Apps Script</h1>
        
        <div class="section">
            <h2>Descripci√≥n General</h2>
            <p>Este script de Google Apps Script permite la creaci√≥n y modificaci√≥n de formularios de Google Forms basados en datos de una hoja de c√°lculo en Google Sheets.</p>
        </div>
        
        <div class="section">
            <h2>Funci√≥n Principal</h2>
            <p><strong>updateExistingFormV2(formId, spreadsheetId)</strong></p>
            <p>Esta funci√≥n abre un formulario de Google Forms y una hoja de c√°lculo de Google Sheets, luego actualiza el formulario con las secciones y preguntas necesarias.</p>
            <pre>
    function updateExistingFormV2(formId, spreadsheetId) {
    var form = FormApp.openById(formId);
    var sheet = SpreadsheetApp.openById(spreadsheetId).getSheetByName('Validaciones');
    var data = sheet.getRange('A2:P').getValues();
    
    form.setTitle('COTIZADOR CELSIA 2.0');
    form.setDescription('Este cotizador cuenta con un alcance de ofertas EPC entre 5kWp y 130kWp.');
    
    addBasicInfo(form);
    addCommercialInfo(form, data);
    addClientInfo(form);
    addTechnicalClientInfo(form, data);
    addTechnicalInfo(form, data);
    addAdjustments(form);
    addInverterInfo(form, data);
}
            </pre>
        </div>

        <div class="section">
            <h2>Funciones Auxiliares</h2>
            <p><strong>addBasicInfo(form)</strong>: Agrega preguntas b√°sicas como correo y contrase√±a.</p>
            <p><strong>addCommercialInfo(form, data)</strong>: Agrega informaci√≥n comercial desde la hoja de c√°lculo.</p>
            <p><strong>addClientInfo(form)</strong>: Agrega informaci√≥n del cliente.</p>
            <p><strong>addTechnicalClientInfo(form, data)</strong>: Agrega preguntas t√©cnicas del cliente.</p>
            <p><strong>addTechnicalInfo(form, data)</strong>: Agrega preguntas t√©cnicas generales.</p>
            <p><strong>addAdjustments(form)</strong>: Agrega ajustes al formulario.</p>
            <p><strong>addInverterInfo(form, data)</strong>: Agrega informaci√≥n sobre inversores.</p>
        </div>
    </div>
    <br>    

  <div class="container" id="Lista">
      <h1>Documentaci√≥n del Script</h1>
      
      <div class="section">
          <h2>Descripci√≥n General</h2>
          <p>Este script actualiza autom√°ticamente las opciones de las preguntas de tipo lista desplegable en un formulario de Google Forms, bas√°ndose en datos de una hoja de Google Sheets.</p>
      </div>

      <div class="section">
          <h2>Funciones Principales</h2>
          <h3>updateAllDropdownsWithLog()</h3>
          <p>Esta funci√≥n toma un ID de formulario y un ID de hoja de c√°lculo, y actualiza las preguntas tipo lista desplegable con los datos de la hoja de validaciones.</p>
          <pre>
function updateAllDropdownsWithLog(formId, spreadsheetId, sheetName, logSheetName)
          </pre>
          <p><strong>Par√°metros:</strong></p>
          <ul>
              <li><code>formId</code>: ID del formulario de Google Forms.</li>
              <li><code>spreadsheetId</code>: ID de la hoja de Google Sheets.</li>
              <li><code>sheetName</code>: Nombre de la hoja que contiene las opciones.</li>
              <li><code>logSheetName</code>: Nombre de la hoja de bit√°cora donde se registran los cambios.</li>
          </ul>
      </div>

      <div class="section">
          <h2>Registro de Cambios</h2>
          <p>El script compara las opciones actuales de cada lista desplegable con las opciones en la hoja de c√°lculo. Si hay cambios, los registra en una hoja de bit√°cora con la siguiente estructura:</p>
          <ul>
              <li>Fecha</li>
              <li>Pregunta</li>
              <li>Tipo de Cambio (Creado, Modificado, Eliminado)</li>
              <li>Opciones Antes</li>
              <li>Opciones Despu√©s</li>
              <li>Ejecutado por</li>
          </ul>
      </div>

      <div class="section">
          <h2>Funci√≥n de Obtenci√≥n de Nombre</h2>
          <h3>obtenerNombreUsuario()</h3>
          <p>Extrae el nombre del usuario a partir del correo electr√≥nico:</p>
          <pre>
function obtenerNombreUsuario(email) {
  var nombre = email.split("@")[0];
  return nombre.charAt(0).toUpperCase() + nombre.slice(1);
 }
          </pre>
      </div>
  </div>
  <br>
  <div class="container">
    <h1>Documentaci√≥n del Script</h1>
    <p>Este script configura la l√≥gica de salto en un formulario de Google Forms basado en las respuestas a una pregunta espec√≠fica.</p>

    <h2>Funcionamiento</h2>
    <p>El script:</p>
    <ul>
        <li>Busca una pregunta espec√≠fica en el formulario.</li>
        <li>Asigna una l√≥gica de salto dependiendo de las respuestas.</li>
        <li>Redirige a diferentes secciones seg√∫n la respuesta seleccionada.</li>
    </ul>

    <h2>Par√°metros</h2>
    <ul>
        <li><strong>formId</strong>: ID del formulario de Google Forms.</li>
    </ul>

    <h2>C√≥digo</h2>
    <code>
function configurarLogicaDeSalto(formId = "1ZspkEQGtga8GSndc7PELRK4IMUjgMRfZDndONPzLEX4") {
var FORM_ID = formId;
var BUSCAR_TITULO = "¬øQu√© tipo de cotizaci√≥n es?"; 
var SECCIONES_DESTINO = { "Oferta": "Ajustess", "Pre-oferta": "INVERSORES" };
var form = FormApp.openById(FORM_ID);
var items = form.getItems();
var preguntaItem = null;
Logger.log("üîç Buscando la pregunta clave en el formulario...");

for (var i = 0; i < items.length; i++) {
var item = items[i];
if (item.getType() === FormApp.ItemType.MULTIPLE_CHOICE && item.getTitle() === BUSCAR_TITULO) {
  preguntaItem = item.asMultipleChoiceItem();
  Logger.log("üéØ ¬°Pregunta encontrada!: " + BUSCAR_TITULO);
  break;
}
}

if (!preguntaItem) {
Logger.log("‚ö†Ô∏è No se encontr√≥ la pregunta en el formulario.");
return;
}

var choices = preguntaItem.getChoices();
var nuevasOpciones = [];

choices.forEach(choice => {
var textoRespuesta = choice.getValue();
var destinoTitulo = SECCIONES_DESTINO[textoRespuesta];
if (!destinoTitulo) {
  nuevasOpciones.push(preguntaItem.createChoice(textoRespuesta, FormApp.PageNavigationType.CONTINUE));
  return;
}

try {
  var destino = form.getItems(FormApp.ItemType.PAGE_BREAK)
    .map(item => item.asPageBreakItem())
    .find(page => page.getTitle() === destinoTitulo);

  if (!destino) {
    nuevasOpciones.push(preguntaItem.createChoice(textoRespuesta, FormApp.PageNavigationType.CONTINUE));
  } else {
    nuevasOpciones.push(preguntaItem.createChoice(textoRespuesta, destino));
  }
} catch (error) {
  nuevasOpciones.push(preguntaItem.createChoice(textoRespuesta, FormApp.PageNavigationType.CONTINUE));
}
});

preguntaItem.setChoices(nuevasOpciones);
Logger.log("‚úÖ L√≥gica de salto configurada correctamente.");
}
    </code>
</div>


  
  <div class="w3-black w3-center w3-padding-24">Powered by <a href="https://www.w3schools.com/w3css/default.asp" title="W3.CSS" target="_blank" class="w3-hover-opacity">w3.css</a></div>

<!-- End page content -->
</div>

<script>
// Script to open and close sidebar
function w3_open() {
    document.getElementById("mySidebar").style.display = "block";
    document.getElementById("myOverlay").style.display = "block";
}
 
function w3_close() {
    document.getElementById("mySidebar").style.display = "none";
    document.getElementById("myOverlay").style.display = "none";
}
</script>

</body>
</html>
